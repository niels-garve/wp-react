version: '3'
services:
  wordpress:
    image: visiblevc/wordpress:latest
    ports:
      - 80:80
      - 443:443
    restart: always
    volumes:
      - ./letsencrypt:/etc/letsencrypt
      - ./data:/data
      - ./wp-content/themes/wp-react-theme:/app/wp-content/themes/wp-react-theme
      - ./wp-content/w3tc-config:/app/wp-content/w3tc-config
      - ./wp-content/uploads:/app/wp-content/uploads
      - ./sw.js:/app/sw.js
      - ./appcache:/app/appcache
    environment:
      SERVER_NAME: mysite.com
      DB_PASS: ${SECURE_PASSWORD}
      PERMALINKS: archives/%post_id%/%postname%/
      PLUGINS: >-
        [yoast-to-rest-api]https://github.com/niels-garve/yoast-to-rest-api/archive/1.4.1.zip,
        wp-optimize,
        wp-migrate-db,
        wordpress-seo,
        w3-total-cache,
        tinymce-clear-buttons,
        regenerate-thumbnails,
        https-redirection,
        disable-emojis,
        custom-post-type-ui,
        [Basic-Auth]https://github.com/WP-API/Basic-Auth/archive/master.zip,
        amazon-web-services,
        amazon-s3-and-cloudfront,
        advanced-custom-fields,
        acf-to-rest-api,
        acf-content-analysis-for-yoast-seo
  db:
    restart: always
    image: mysql:5.7
    volumes:
      - data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${SECURE_PASSWORD}

volumes:
  data:
